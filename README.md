# reRoute_Dynamics - A Battery-Electric Bus Simulaton Toolkit
---
## About
---
reRoute_Dynamics is a software package that is a more thourouglhly refined version of [Route_Dynamics](https://github.com/EricaEgg/Route_Dynamics). Its intention is to provide the tools and framework needed to estimate energy demand for a battery-electric bus (or other vehicle) provided adequate geospatial and conditional data. 



## Table of Contents
---

- [Installation](#installation)
- [Usage](#usage)
- [Repository Structure](#repository-structure)
- [Credits & Contribution](#credits-and-contribution)
- [Misc](#misc)
- [Licese](#license)


## Installation (via git)
---
This set of tools is based in Python 3.12. Any and all packages needed are listed in the environment.yml file, which can be used with Conda to re-generate the development environment. The package was developed and tested in Ubuntu 22.04, and validated to run on Windows 10.

1. Clone the repository & navigate in:
```bash
git clone https://github.com/sebpeck/reRoute_Dynamics

cd reRoute_Dynamics
```

2. Set up an environment in conda from the environment.yml file and open the environment:
```bash
conda env create --name MyEnvironmentName --file=environment.yml

conda activate MyEnvironmentName
```

For more detailed instructions on installing conda, please visit the [Conda install guide](https://docs.conda.io/projects/conda/en/latest/user-guide/install/index.html).

## Usage
---
The following two options are the most bare-bones examples. For more detailed and comprehensive uses, please see:
```bash
/Examples/
```
And for module documentation, please visit the [ReadTheDocs](https://reroute-dynamics.readthedocs.io/en/latest/index.html)!
1. Using reRoute_Dynamics as a package:

First, get the package set up for use in your current directory
```python
import os
import sys
sys.path.append('../src/reRoute_Dynamics_Core/')
```
Now, we use Geography_Tools to load up a route path. For more information on making a route path, see:
```bash
/Examples/Geography_Tools_Examples.ipynb.
```

```python
# import the geography tools module
import Geography_Tools as gt

# Use geography_tools to load a premade route path.
route_obj = gt.load_from_json("path/to/route/file.json")
```

Then, we need to load up our Trip, Bus, and ESS. More information about these files can be found in:
```bash
/Examples/Object_Params_Example.ipynb
```

```python
# import the object parameters module
import Object_Params as op

# Load up the trip, bus, and ESS object parameters. For more information on making
# these, see Object_Params_Example.ipynb
trip_obj = op.load_trip_params("path/to/trip/file.txt")
bus_obj = op.load_bus_params("path/to/bus/file.txt")
ESS_obj = op.load_ESS_params("path/to/ESS/file.txt")
```

Finally, we use Trip_Simulator to run the trip.
```python
# import the trip simulator module
import Trip_Simulator as ts

results = ts.simulate_trip(route_obj, trip_obj, bus_obj, ESS_obj)
```

2. Using reRoute_Dynamics as a script:
Trip_Simulator.py can also be run as a standalone script, assuming you have your route and object files prepared:
```bash
python3 /src/reRoute_Dynamics_Core/Trip_Simulator.py
```
If no extra arguments are provided, it will prompt the user for the correct input, and then save the results as a .feather file.


## Repository Structure
---
- src: Contains primary directories for packages
  - reRoute_Dynamics_Core: Contains the primary .py files used in the toolkit for modeling.
    - Geography_Tools.py - Python file used for most geospatial data loading and calculation. Includes Raster handling.
    - Instance_Tools.py - Python file used for helping interperet Route() objects from Geography_Tools.py and preparing them for use in Trip_Simulator.py.
    - Object_Params.py - Python file that is used for generating and saving object classes like Trips, Busses, and ESS's. 
    - Physics_Engine.py - Python file that handles most of the physics calculations of a given trip, including braking, accelerating, and maintaing speed. 
    - Trip_Simulator.py - Python file that acts as a script to run a given Bus() with a given ESS() on a given Trip().
- Examples: Contains example scripts, files, and notebooks.
    - KC_Example_Data: Contains example data that can be used for running simulated trips. 
        - Acceleration_Profiles: directory that contains possible acceleration profiles.
            - Erica_Acceleration.csv - This file is an example acceleration profile (First column in seconds, second in g's) that was used by Erica in the original version. It was interpolated from data provided by King County Metro, but that data and its source is no longer available.
            - Braunschweig_Acceleration.csv - This file is an example acceleration profile (First column in seconds, second in g's) that was generated by aggregating the accelerations shown in the [Braunshcweig Driving Cycle provided by NREL](https://web.archive.org/web/20241128131551/https://www.nrel.gov/transportation/drive-cycle-tool/)
            - Custom_Acceleration.csv - This is an acceleration profile that is used for testing and validation in Monte Carlo simulations
            - example_profile.csv - an Example acceleration profile, used in some examples. 
            - spitball.csv / slapdash.csv - Acceleration profiles used in testing and experimentation
            - Agg_Acceleration.csv - Aggregated acceleration profile generated from the mean positive acceleration of actual bus runtime data.
        - Example_Raster_Data: directory that would contain raster data from [King County West's 2021 DTM Survey](https://lidarportal.dnr.wa.gov/) at https://lidarportal.dnr.wa.gov/, but it's too large. See enclosed note in /KC_West_2021/dtm/.
        - Example_Route_Data: directory that holds handmade CSV's for routes stops and road points.
        - KC_Route_Data: Contains Ridership Data from Erica's work with King County (Source Unknown), [Street Geodata](https://gis-kingcounty.opendata.arcgis.com/datasets/3936d3ad103945aabd7b0261afa0686d_394/explore?location=47.643846%2C-122.114739%2C15.43), [Signal Geodata](https://gis-kingcounty.opendata.arcgis.com/search?q=signals&tags=transportation_OpenData), and information from [King County's GTFS Feed](https://kingcounty.gov/en/dept/metro/rider-tools/mobile-and-web-apps#toc-developer-resources)
        - KC_Survey_Benchmarks: Contains King County Survey Benchmarks from [NOAA's National Geodetic Survey Database](https://www.ngs.noaa.gov/datasheets/)
        
        - Example_Route_Save: Directory that contains example json savefiles for Route objects.
        - Misc: directory that contains images to be displayed in example notebooks and other miscellaneous files.
        - Saved_Objects: directory that holds example saved objects as produced by Object_Tools.py.
        - Saved_Routes: directory that holds example saved Routes() as produced by Geography_Tools.py
    - KC_Query_Tools.py - Python file used for querying the King-County-specific information
    - KC_Route_Testing.py - Python file that is used and contains the methods for testing King-County-specific bus routes.
    - King_County_BEV_Sim.ipynb - Jupyter Notebook that contains a brief example on using KC_Query_Tools.py and KC_Route_Testing.py, as well as Object_Methods.py.
    - Physics_Engine_Examples.ipynb - A brief walkthrough notebook showcasing Physics_Engine.py.
    - Object_Params_Example.ipynb - A walkthrough notebook showcasing Object_Params.py.
    - Geography_Tools_Examples.ipynb - A Notebook of instruction on the use of Geography_Tools.py.
    - Bus_Model_Info.ipynb - A Notebook used to update and log Bus Models used for modeling and evaulation. 
    - Model_Evaluation.ipynb - Jupyter Notebook used for demonstrating how to run a Monte Carlo simulation as well as for model evaluation.
- Tests: Contains tests and testing materials for methods in src.
- Supplimentary: Contains supplimentary materials, initially used in the development. This is unorganized and unruly. 
- docs: Folder intended for use with ReadTheDocs.
- Paper: Directory for storing JOSS paper draft and supplimentary information.
- environment.yml: Environment file, used in Conda to recreate python kernel environment.


## Credits & Contribution:
---
### Credits: 
- Author: Sebastian Peck
- Advisor: Dr. Daniel T. Schwartz
- Original Concept & Initial iteration: Dr. Erica Eggleton
- Acknowledgments:
Special thanks to Dr. Dave Beck for providing additional support and mentorship during this process!

### Contribution:
If you have ideas or thoughts you'd like to contribute, please feel free to do it through the 2 following methods:
1. Issues: 
If you encounter any issues or have possible ideas, please raise an issue on GitHub.

2. Modifications & Updates:
If you'd like to contribute fixes or changes, please take the following steps:
- Fork the Repositry
- Create a new branch: `git checkout -b BranchName`.
- Make changes.
- Push branch: `git push origin BranchName`.
- Create a pull request.



## Misc 
---
https://gis-kingcounty.opendata.arcgis.com/maps/284a6b7a12a04016ab8b754e3b354e47

## Sebastian's To Do List: 
4/14/2025
- Finalize in-line parameter citations in Geography_Tools, Object_Params and Physics_Engine
- Set up ReadTheDocs
- Draft Joss Paper again
- Adress Issue 1 completely
    - Verify where Erica's previous code has been presented or published
    - Make sure user guide is user friendly and followable
    - Are Demos reproducible on Mac?
    - Fully revise paper from current rough draft state
    - Contact Erica to review
    
    
# License
---
This project is licensed under the [MIT License](https://en.wikipedia.org/wiki/MIT_License)
